# CLAUDE.md — BookForge

## Project Overview

**BookForge** is an AI-powered web app that generates print-ready English learning workbooks for Amazon KDP. Users select book type, CEFR level, topic, and exercises — AI generates structured content — one-click export to KDP-ready PDF.

**Problem:** Creating quality English workbooks takes weeks. BookForge does it in 30 minutes.

## Tech Stack

- **Framework:** Next.js 16 (App Router, RSC, Turbopack)
- **UI:** React 19 + Tailwind CSS 4 + shadcn/ui
- **PDF:** @react-pdf/renderer (client-side PDF generation)
- **AI:** OpenAI SDK with Zod structured output
- **Validation:** Zod (schemas → inferred types)
- **Forms:** react-hook-form + @hookform/resolvers
- **Testing:** Vitest + @testing-library/react
- **Package Manager:** pnpm
- **Deploy:** Vercel

## Directory Structure

```
bookforge/
├── app/
│   ├── layout.tsx              # Root layout
│   ├── page.tsx                # Book builder form (main page)
│   ├── globals.css             # Tailwind + CSS variables
│   ├── api/generate/route.ts   # POST: AI content generation
│   └── preview/page.tsx        # PDF preview + download
├── lib/
│   ├── schemas/book.ts         # Zod schemas (source of truth)
│   ├── ai/generate-book.ts     # OpenAI structured output
│   ├── pdf/document.tsx        # @react-pdf/renderer components
│   └── utils.ts                # cn() helper
├── components/
│   └── ui/                     # shadcn components
├── docs/
│   └── prd.md                  # Product requirements
├── CLAUDE.md                   # This file
├── README.md                   # Human docs
├── package.json
├── tsconfig.json
├── next.config.ts
├── eslint.config.mjs
├── vitest.config.ts
├── components.json             # shadcn config
└── .env.local.example
```

## Common Commands

```bash
pnpm dev          # Start dev server (Turbopack)
pnpm build        # Production build
pnpm lint         # ESLint
pnpm format       # Prettier
pnpm test         # Vitest (watch mode)
pnpm test:run     # Vitest (single run)
```

## SGR / Domain-First

**Schemas are the source of truth.** Read `lib/schemas/book.ts` FIRST before any work.

| Schema | Purpose |
|--------|---------|
| `BookConfig` | User input: title, type, level, topic, exercises |
| `Exercise` | Single exercise with typed content (union of 9 exercise content types) |
| `BookSection` | Group of exercises with title/description |
| `GeneratedBook` | Complete book: config + sections |
| `CEFRLevel` | A1-C2 enum |
| `BookType` | grammar_workbook, vocabulary_builder, etc. |
| `ExerciseType` | 9 exercise types (fill_in_blank, multiple_choice, etc.) |

**Data flow:** `BookConfig` → OpenAI API (structured output) → `GeneratedBook` → `@react-pdf/renderer` → PDF

## Architecture

- **Server Components by default** — only `"use client"` where needed (forms, PDF viewer)
- **API Route** (`app/api/generate/route.ts`) — handles OpenAI calls server-side (keeps API key secure)
- **PDF generation is client-side** — @react-pdf/renderer runs in browser, no server load
- **Stateless** — no database, no user accounts. Generate → download → done.
- **Zod everywhere** — form validation, API request validation, AI output validation

## Key Decisions

- **No database** — stateless tool, MVP doesn't need persistence
- **No auth** — free tool for MVP, add Stripe/auth when validated
- **Client-side PDF** — avoids server memory issues, user sees preview before download
- **OpenAI structured output** — Zod schemas ensure consistent AI responses
- **KDP margins** — hardcoded per trim size (6x9, 8.5x11) in `lib/pdf/document.tsx`

## Environment Variables

```
OPENAI_API_KEY=sk-...     # Required
OPENAI_MODEL=gpt-4o       # Optional (default: gpt-4o)
```

## Do

- Define schemas in `lib/schemas/` before writing any logic
- Use Zod for all validation (forms, API, AI output)
- Keep components small and focused
- Use Server Components where possible
- Test schemas and business logic (not UI layout)

## Don't

- Don't add a database unless explicitly requested
- Don't add authentication for MVP
- Don't use raw untyped data — always go through schemas
- Don't render PDF server-side — it's client-only
- Don't hardcode exercise content — everything comes from AI generation

---

*Stack: nextjs-supabase (simplified) | Generated by /scaffold-project*
